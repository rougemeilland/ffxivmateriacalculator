(function(){function r(t,i){for(var o=!1,r,f,u,e;!o;)r=t(),r===undefined?o=!0:(r<0?(u=n,f=!1):r<55296?(u=r,f=!1):r<56320?(u=r,f=!0):r<57344?(u=n,f=!1):r<65536?(u=r,f=!1):(u=n,f=!1),f&&(e=t(),e===undefined?(u=n,o=!0):u=e<56320||e>=57344?n:((u&1023)<<10|e&1023)+65536),i(u))}function u(t,i){if(t<0&&(t=n),t<65536)i(t);else{var r=t-65536,u=r>>10,f=r&1023;u>=1024?i(n):(i(u+55296),i(f+56320))}}function h(t,i){for(var s=!1,r,f,u,o,e;!s;)if(r=t(),r===undefined)s=!0;else{for((r&-256)!=0?(u=n,f=0):(r&128)==0?(u=r&127,f=0):(r&224)==192?(u=r&31,f=1):(r&240)==224?(u=r&15,f=2):(r&248)==240?(u=r&7,f=3):(r&252)==248?(u=r&3,f=4):(r&254)==252?(u=r&1,f=5):(u=n,f=0),o=0;o<f;++o){if(e=t(),e<128||e>191){u=n;break}u=u<<6|e&63}i(u)}}function f(t,i){(t<0||t>2147483647)&&(t=n);t<=127?i(t&127):t<=2047?(i(t>>6&31|192),i(t&63|128)):t<=65535?(i(t>>12&15|224),i(t>>6&63|128),i(t&63|128)):t<=2097151?(i(t>>18&7|240),i(t>>12&63|128),i(t>>6&63|128),i(t&63|128)):t<=67108863?(i(t>>24&3|248),i(t>>18&63|128),i(t>>12&63|128),i(t>>6&63|128),i(t&63|128)):(i(t>>30&1|252),i(t>>24&63|128),i(t>>18&63|128),i(t>>12&63|128),i(t>>6&63|128),i(t&63|128))}function e(){function e(n){r+=String.fromCharCode(n)}function o(n){n===t||n===i||u(n,e)}function s(){return f>=n.length?undefined:n[f++]&255}var n=this,r="",f;return n.length<=0?r:(f=0,h(s,o),r)}function c(n){function o(n){u.push(n)}function s(n){f(n,o)}function h(){return e>=i.length?undefined:i.charCodeAt(e++)}var i=this,u=[],e;return(n===undefined&&(n=!1),i.length<=0)?u:(e=0,n&&f(t,o),r(h,s),new Uint8Array(u))}function o(r){function c(n){s+=String.fromCharCode(n)}function l(){var n,t;return u>=f.length?undefined:u+1>=f.length?(u=f.length,-1):(n=f[u],++u,t=f[u],++u,((n|t)&-256)!=0?-1:r?n<<8|t:t<<8|n)}var f=this,s="",u,h,o,e;if(r===undefined&&(r=!0),f.length<=0)return s;for(u=0,h=!1;!h;)o=l(),o===undefined?(e=-1,h=!0):e=o<0?n:o,e>=0&&(e===t||(e===i?r=!r:c(e)));return s}function l(n,i){function s(t){n?(r.push(t>>8&255),r.push(t&255)):(r.push(t&255),r.push(t>>8&255))}function h(){return f>=u.length?undefined:u.charCodeAt(f++)}var u=this,r=[],f,e,o;if(n===undefined&&(n=!0),i===undefined&&(i=!0),u.length<=0)return r;for(f=0,i&&s(t),e=!1;!e;)o=h(),o===undefined?e=!0:s(o);return new Uint8Array(r)}function s(r){function c(n){s+=String.fromCharCode(n)}function l(){var n,t,i,u;return f>=e.length?undefined:f+3>=e.length?(f=e.length,-1):(n=e[f],++f,t=e[f],++f,i=e[f],++f,u=e[f],++f,((n|t|i|u)&-256)!=0?-1:r?n<<24|t<<16|i<<8|u:u<<24|i<<16|t<<8|n&255)}var e=this,s="",f,h,o;if(r===undefined&&(r=!0),e.length<=0)return s;for(f=0,h=!1;!h;){if(o=l(),o===undefined){h=!0;break}o<0?o=n:o===t||(o===i?r=!r:u(o,c))}return s}function a(n,i){function o(t){n?(u.push(t>>24&255),u.push(t>>16&255),u.push(t>>8&255),u.push(t&255)):(u.push(t&255),u.push(t>>8&255),u.push(t>>16&255),u.push(t>>24&255))}function s(){return e>=f.length?undefined:f.charCodeAt(e++)}var f=this,u=[],e;return(n===undefined&&(n=!0),i===undefined&&(i=!0),f.length<=0)?u:(e=0,i&&o(t),r(s,o),new Uint8Array(u))}const n=65533,t=65279,i=65534;Array.prototype.toStringByUTF8Encoding=e;Uint8Array.prototype.toStringByUTF8Encoding=e;String.prototype.toByteArrayByUTF8Encoding=c;Array.prototype.toStringByUTF16Encoding=o;Uint8Array.prototype.toStringByUTF16Encoding=o;String.prototype.toByteArrayByUTF16Encoding=l;Array.prototype.toStringByUTF32Encoding=s;Uint8Array.prototype.toStringByUTF32Encoding=s;String.prototype.toByteArrayByUTF32Encoding=a})(),function(){Array.prototype.distinct=function(n){var r,t,u,f,i,e;if(n===undefined)return this.filter(function(n,t,i){return i.indexOf(n)===t});for(r=[],t=0;t<this.length;++t){for(u=this[t],f=!1,i=t+1;i<this.length;++i)if(e=this[i],n(u,e)){f=!0;break}f||r.push(u)}return r};Array.prototype.where=function(n){return this.filter(function(t,i){return n(t,i)})};Array.prototype.select=function(n){return this.map(function(t,i){return n(t,i)})};Array.prototype.selectMany=function(n){for(var i=[],t=0;t<this.length;++t)i.push.apply(i,n(this[t],t));return i};Array.prototype.union=function(n,t){for(var r,u,f,o,i=this.concat(),e=0;e<n.length;++e){if(r=n[e],t===undefined)u=i.indexOf(r)>=0;else for(u=!1,f=0;f<i.length;++f)if(o=i[f],t(r,o)){u=!0;break}u||i.push(r)}return i};Array.prototype.except=function(n,t){for(var i,r,u,o,e=[],f=0;f<this.length;++f){if(i=this[f],t===undefined)r=n.indexOf(i)>=0;else for(r=!1,u=0;u<n.length;++u)if(o=n[u],t(i,o)){r=!0;break}r||e.push(i)}return e};Array.prototype.equals=function(n,t){var i,r,u;if(this.length!==n.length)return!1;for(i=0;i<this.length;++i)if(r=this[i],u=n[i],t===undefined?r!==u:!t(r,u))return!1;return!0};Array.prototype.orderBy=function(n){var t=this.concat();return n===undefined?t.sort():t.sort(function(t,i){var r=n(t),u=n(i);return r>u?1:r<u?-1:0}),t};Array.prototype.orderByDescending=function(n){var t=this.concat();return n===undefined?t.sort(function(n,t){return n>t?-1:n<t?1:0}):t.sort(function(t,i){var r=n(t),u=n(i);return r>u?-1:r<u?1:0}),t};Array.prototype.contains=function(n,t){var r,i;if(t===undefined)return this.indexOf(n)>=0;for(r=!1,i=0;i<this.length;++i)if(t(this[i],n)){r=!0;break}return r};Array.prototype.any=function(n){var i,t;if(n===undefined)return this.length>0;for(i=!1,t=0;t<this.length;++t)if(n(this[t])){i=!0;break}return i};Array.prototype.all=function(n){for(var i=!1,t=0;t<this.length;++t)if(!n(this[t])){i=!0;break}return!i};Array.prototype.toObject=function(n,t){for(var r={},u=0;u<this.length;++u){var f=this[u],i=n(f),e=t===undefined?f:t(f);if(i===undefined||i===null)throw new Error("key is undefined or null.");if(r.hasOwnProperty(i)){console.log("dic="+JSON.stringify(r)+", key="+i);throw new Error("An element with the same key already exists in the Object.");}r[i]=e}return r};Array.prototype.most=function(n,t){for(var r,f,u=-1,e=null,o=NaN,i=0;i<this.length;++i)r=this[i],(t===undefined||t(r,i))&&(f=n(r,i),(u<0||o<f)&&(u=i,e=r,o=f));return u<0?undefined:e};Array.prototype.least=function(n,t){for(var r,f,u=-1,e=null,o=NaN,i=0;i<this.length;++i)r=this[i],(t===undefined||t(r,i))&&(f=n(r,i),(u<0||o>f)&&(u=i,e=r,o=f));return u<0?undefined:e}}(),function(){function f(n,t,i,r){i===undefined&&(i=0);r===undefined&&(r=n.length);i<0&&(i+=n.length);r<0&&(r+=src_array.length);for(var u=i;u<r;++u)n[u]=t}function t(n){for(var v=n.length,u=0,s=Number.POSITIVE_INFINITY,i,h,c,r,f,l,e,a,p,t=0,y=v;t<y;++t)n[t]>u&&(u=n[t]),n[t]<s&&(s=n[t]);for(h=1<<u,c=o(h),r=1,f=0,l=2;r<=u;){for(t=0;t<v;++t)if(n[t]===r){for(e=0,a=f,i=0;i<r;++i)e=e<<1|a&1,a>>=1;for(p=r<<16|t,i=e;i<h;i+=l)c[i]=p;++f}++r;f<<=1;l<<=1}return[c,u,s]}function c(i,r){function et(){if(l===0)throw new Error("Internal error(readWord): must call readWord() after calling skipBitsUntilNextByte()");if(f+1>=i.length)throw new Error("Unexpected EOF.");var n=a(f++),t=a(f++);return t<<8|n}function ot(n,t){var h;if(n<=0||n>63)throw new Error("Internal error(readBits/peekBits): bitLength is out of range.");var u=n,o=l,e=f,v=o,r=0,c=0;if(o>0){if(e>=i.length)throw new Error("Unexpected EOF.");h=8-v;h>u&&(h=u);r=a(e)>>v&s[h];c=h;o+=h;o>=8&&(o-=8,++e);u-=h}while(u>=8){if(e>=i.length)throw new Error("Unexpected EOF.");r|=a(e++)<<c;c+=8;u-=8}if(u>0){if(e>=i.length)throw new Error("Unexpected EOF.");r|=(a(e)&s[u])<<c;o=u}if(r<0)throw new Error("Internal error(readBits/peekBits): bad value: bitLength="+n.ToString()+",value="+r.ToString()+"("+r.ToString("x")+")");if(n<=8&&r>=256)throw new Error("Internal error(readBits/peekBits): bad value: bitLength="+n.ToString()+",value="+r.ToString()+"("+r.ToString("x")+")");if(n<=16&&r>=65536)throw new Error("Internal error(readBits/peekBits): bad value: bitLength="+n.ToString()+",value="+r.ToString()+"("+r.ToString("x")+")");if(n<=32&&r>=4294967296)throw new Error("Internal error(readBits/peekBits): bad value: bitLength="+n.ToString()+",value="+r.ToString()+"("+r.ToString("x")+")");return t||(l=o,f=e),r}function c(n){return ot(n,!1)}function at(n){return ot(n,!0)}function ut(n){var i=n[0],r=n[1],t=i[at(r)],u=t>>16;return c(u),t&65535}function st(n,t){for(var i,r,u;(i=ut(n))!==256;)if(i<256)w(i);else{var f=i-257,e=g[f],o=d[f];o>0&&(e+=c(o));i=ut(t);r=k[i];u=nt[i];u>0&&(r+=c(u));b(r,e)}}function vt(){var n=et(),t=et();if(n!==~t)throw new Error("Bad LEN & NLEN field.");rt(n)}function yt(){st(tt,it)}function pt(){function s(n,t,u){for(i=0;i<n;){var e=ut(t),f;switch(e){case 16:for(f=3+c(2);f-->0;)u[i++]=r;break;case 17:for(f=3+c(3);f-->0;)u[i++]=0;r=0;break;case 18:for(f=11+c(7);f-->0;)u[i++]=0;r=0;break;default:u[i++]=e;r=e}}return u}for(var f=c(5)+257,e=c(5)+1,v=c(4)+4,o=n(h.length),r=0,u,l,a,i=0;i<v;++i)o[h[i]]=c(3);u=t(o);l=n(f);a=n(e);st(t(s(f,u,l)),t(s(e,u,a)))}function ct(){var n=c(3),i=n&1,t=n>>1;switch(t){case 0:vt();break;case 1:yt();break;case 2:pt();break;case 3:default:throw new Error("Unknown block type.: block_type="+t.ToString());}return i!==0}function lt(n){while(!ct())if(f>=ft+ht){ft=f;n("progress",f/i.length);setTimeout(function(){lt(n)},10);return}if(f+l/8<=i.length-1)throw new Error("Unexpected data after FINAL");v();n("progress",1);n("complete",e)}var a,p,w,b,v,rt,y,ft,ht;if(r===undefined&&(r={}),i instanceof Array)destinationIsTypeArray=!1,sourceIsTypeArray=!1;else if(i instanceof Uint8Array)r.useTypedArray?(destinationIsTypeArray=u,sourceIsTypeArray=!0):(destinationIsTypeArray=!1,sourceIsTypeArray=!1);else{console.log("sourceBuffer instanceof Array => "+(i instanceof Array));console.log("sourceBuffer instanceof Uint8Array => "+(i instanceof Uint8Array));console.log("Object.prototype.toString.call(sourceBuffer) => "+Object.prototype.toString.call(i));throw new TypeError("Not suppoered type.");}a=sourceIsTypeArray?function(n){return i[n]}:function(n){var t=i[n];if((t&-256)!=0)throw new Error("Found large byte data.");return t};destinationIsTypeArray?(y=function(n){while(o+n>e.length){var t=new Uint8Array(e.length+(n+1023)*1);t.set(e);e=t}},p=function(){return new Uint8Array(0)},w=function(n){if((n&-256)!=0)throw new Error("Internal error(writeByte): data is too large.");y(1);e[o]=n;++o},b=function(n,t){var i,r,u;if(n<=0)throw new Error("Internal error(rewriteBytes): distance is zero or negative.");if(t<=0)throw new Error("Internal error(rewriteBytes): distance is length or negative.");if(i=o-n,i<0)throw new ArgumentException;for(r=o,u=t,y(t);u-->0;)e[r++]=e[i++];o+=t},v=function(){e=e.slice(0,o)},rt=function(n){if(l===0)throw new Error("Internal error(copyBytes): must call copyBytes() after calling skipBitsUntilNextByte()");if(f+n-1>=i.length)throw new Error("Unexpected EOF.");y(n);e.set(i.subarray(f,f+n),o);f+=n;o+=n}):(p=function(){return[]},w=function(n){if((n&-256)!=0)throw new Error("Internal error(writeByte): data is too large.");e.push(n);++o},b=function(n,t){var i,r;if(n<=0)throw new Error("Internal error(rewriteBytes): distance is zero or negative.");if(t<=0)throw new Error("Internal error(rewriteBytes): distance is length or negative.");if(i=o-n,i<0)throw new ArgumentException;for(r=t;r-->0;)e.push(e[i++]);o+=t},v=function(){},rt=function(n){if(l===0)throw new Error("Internal error(copyBytes): must call copyBytes() after calling skipBitsUntilNextByte()");if(f+n-1>=i.length)throw new Error("Unexpected EOF.");_allocateBuffer(n);for(var t=0;t<n;++t)e.push(a(f++)),++o});var f=0,l=0,e=p(),o=0;if(ft=0,ht=Math.floor(i.length/100),r.callback===undefined){while(!ct());if(f+l/8<=i.length-1)throw new Error("Unexpected data after FINAL");return v(),e}lt(r.callback)}var l=Uint8Array,n=function(n){return new Uint8Array(n)},i=function(n){return new Uint8Array(n)},e=function(n,t,i,r){n.fill(t,i,r)},a=Uint16Array,v=function(n){return new Uint16Array(n)},r=function(n){return new Uint16Array(n)},y=function(n,t,i,r){n.fill(t,i,r)},p=Uint32Array,o=function(n){return new Uint32Array(n)},w=function(n){return new Uint32Array(n)},b=function(n,t,i,r){n.fill(t,i,r)},u=!0;Uint8Array.prototype.fill&&Uint8Array.prototype.slice||(l=Array,n=function(n){return new Array(n)},i=function(n){return n},e=function(n,t,i,r){f(n,t,i,r)},u=!1,console.log("Uint8Array�ɃT�|�[�g����Ă��Ȃ�����b�h�����邽�߁A�����Array��g�p���܂��B"));Uint16Array.prototype.fill&&Uint16Array.prototype.slice||(a=Array,v=function(n){return new Array(n)},r=function(n){return n},y=function(n,t,i,r){f(n,t,i,r)},u=!1,console.log("Uint16Array�ɃT�|�[�g����Ă��Ȃ�����b�h�����邽�߁A�����Array��g�p���܂��B"));Uint32Array.prototype.fill&&Uint32Array.prototype.slice||(p=Array,o=function(n){return new Array(n)},w=function(n){return n},b=function(n,t,i,r){f(n,t,i,r)},u=!1,console.log("Uint32Array�ɃT�|�[�g����Ă��Ȃ�����b�h�����邽�߁A�����Array��g�p���܂��B"));const s=r([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535]),h=i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=r([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),d=i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),g=r([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),nt=i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tt=function(){for(var r=n(288),i=0,u=r.length;i<u;)r[i]=i<=143?8:i<=255?9:i<=279?7:8,++i;return t(r)}(),it=function(){var i=n(30);return e(i,5),t(i)}();Array.prototype.inflate=function(n){return c(this,n)};Uint8Array.prototype.inflate=function(n){return c(this,n)}}();$(function(){function t(n){return n!==null&&n.toString().match(/^[1-9][0-9]*$/)!==null?parseInt(n):-1}function i(n){return n!==null&&n.match(/^0|([1-9][0-9]*)$/)!==null?parseInt(n):-1}function r(t){switch(n){case"de":return t!==null&&t.match(/^ *[0-9\.]+$ */)!==null?parseInt(t.split(".").join("").trim()):-1;case"fr":return t!==null&&t.match(/^[0-9 ]+$/)!==null?parseInt(t.split(" ").join("").trim()):-1;case"en":case"ja":default:return t!==null&&t.match(/^ *[0-9０-９,]+$ */)!==null?parseInt(t.toHankakuAlphaNumericString().split(",").join("").trim()):-1}}function u(n){var i="",t;const r=10;for(t=r;t<=n;t+=r)i+="■";for(;t<=100;t+=r)i+="□";$("#loadingprogress").text(i)}function f(n){function r(){var n=Math.floor((t*.2+i*.8)*100);t<1?console.log("progress: loading "+Math.floor(t*100)+"% (total "+n+"%)"):i<1?console.log("progress: inflate "+Math.floor(i*100)+"% (total "+n+"%)"):console.log("progress: complete");$("#loadingprogresspercent").text(n);u(n)}function f(n,u){var f=new XMLHttpRequest;f.open("GET",n,!0);f.responseType="arraybuffer";f.onload=function(){if(f.response){t=1;var n=new Uint8Array(f.response);n.inflate({useTypedArray:!1,callback:function(n,t){if(n==="progress")i=t,r();else if(n==="complete"){var f=t.toStringByUTF8Encoding();f!==undefined&&f!==null&&u(null,JSON.parse(f))}}})}};f.onprogress=function(n){if(n.lengthComputable){var i=n.loaded/n.total;i>=t+.01&&(t=i,r())}};f.onerror=function(n){u(n)};r();f.send()}var t=0,i=0;f("master_data.json.z",function(t,i){if(t===null){var r=(new Date).getTime();n(i)}})}var n=$("#currentlanguage").val();switch(n){case"en":case"de":case"fr":case"ja":break;default:n="en"}String.prototype.toHankakuAlphaNumericString=function(){return this.replace(/[Ａ-Ｚａ-ｚ０-９，．‐　]/g,function(n){return n>="Ａ"&&n<="Ｚ"?String.fromCharCode(n.charCodeAt(0)-"Ａ".charCodeAt(0)+"A".charCodeAt(0)):n>="ａ"&&n<="ｚ"?String.fromCharCode(n.charCodeAt(0)-"ａ".charCodeAt(0)+"a".charCodeAt(0)):n>="０"&&n<="９"?String.fromCharCode(n.charCodeAt(0)-"０".charCodeAt(0)+"0".charCodeAt(0)):n==="，"?",":n==="．"?".":n==="‐"?"-":n==="　"?" ":n})};Number.prototype.toPriceNumberString=function(){switch(n){case"de":return this.toString().replace(/([0-9])(?=([0-9]{3})+(?![0-9]))/g,"$1.");case"fr":return this.toString().replace(/([0-9])(?=([0-9]{3})+(?![0-9]))/g,"$1 ");case"en":case"ja":default:return this.toString().replace(/([0-9])(?=([0-9]{3})+(?![0-9]))/g,"$1,")}};f(function(u){function rt(){var t='<option value="" selected="selected"><\/option>';return $.each(s,function(i,r){r!==null&&(t+='<option value="'+r.status_id+'">'+r.name[n]+"<\/option>")}),t}function ut(n,t){var r="",u,i;if(n>0&&n<w.length&&t>0&&t<o.length)for(u=tt[n][t],i=1;i<=u;++i)r+='<option value="'+i+'"'+(i===1?' selected="selected"':"")+">+"+i+"<\/option>";return r}function ft(){function i(n,t,i,f,e){return"<tr data-"+i+'="'+f+'" data-itempriceavailable="false" style="display:none;"><td class="priceheaderstyle"><a href="http://jp.finalfantasyxiv.com/lodestone/playguide/db/item/'+e+'/" target="_blank">'+t+'<\/a><\/td><td><input type="checkbox" id="itemused'+n+'" data-itemid="'+n+'" data-itempriceid="itemprice'+n+'" data-itemnotusedtextid="itemnotusedtext'+n+'" data-itempriceerrormessageid="itempriceerrormessage'+n+'"/><input type="text" id="itemprice'+n+'" class="priceboxstyle" data-itemid="'+n+'" data-itemusedid="itemused'+n+'" data-itempriceerrormessageid="itempriceerrormessage'+n+'"/>'+r+'<\/td><td><span id="itemnotusedtext'+n+'" class="itemnotusedtextstyle" style="display:none;"> '+u+'<\/span><span id="itempriceerrormessage'+n+'" data-text="" class="errormessageiconstyle" style="display:none;">！<\/span><\/td><\/tr>'}var r=nt[n],u=$("#notusedmateriatext").val(),t="";return $.each(a,function(r,u){if(u!==null){var e=u.item_id,o=f[e];t+=i(e,o.name[n],"materiaid",u.materia_id,o.official_site_db_id)}}),$.each(l,function(r,u){if(u!==null){var e=u.item_id,o=f[e];t+=i(e,o.name[n],"catalystid",u.catalyst_id,o.official_site_db_id)}}),t}function e(n){$.each(["mainview","resultview","errorview","generalsettingview","outlineview"],function(t,i){i===n?$("#"+i).show():$("#"+i).hide()})}function h(n,i){var e=t($("#"+i).val()),u=t($("#"+n).val()),r=$("#"+n).data("statusvalueid"),f=ut(u,e);r!==undefined&&u>0&&f.length>0?$("#"+r).html(f).show():$("#"+r).html("").hide();["#statustype1","#statustype2","#statustype3","#statustype4","#statustype5"].any(function(n){return t($(n).val())>0})?($("#statusselectionerrormessage").hide(),$("#itempricelistview").show()):($("#itempricelistview").hide(),$("#statusselectionerrormessage").show())}function et(){var n={};return $("#itempricelist tr[data-availableitemprice='true'] input[type='checkbox']").each(function(t,i){var u=$(i).data("itemid"),e=$(i).data("itempriceid"),f=r($("#"+e).val());$(i).prop("checked")?f>0&&(n[u]=f):n[u]=-1}),n}function d(){var n=["statustype1","statustype2","statustype3","statustype4","statustype5"].select(function(n){return t($("#"+n).val())}).where(function(n){return n>0}).distinct(),i=t($("#maximumgradeid").val());$("#itempricelist tr[data-itempriceavailable]").each(function(t,r){var f=$(r).data("materiaid"),u,e;f!==undefined?(u=a[f],u.grade_id<=i&&n.contains(u.status_id)?$(r).attr("data-availableitemprice","true").show():$(r).removeAttr("data-availableitemprice").hide()):(e=$(r).data("catalystid"),e!==undefined&&$(r).attr("data-availableitemprice","true").show())})}function c(){var n=[{status_type_id:"statustype1",status_value_id:"statusvalue1"},{status_type_id:"statustype2",status_value_id:"statusvalue2"},{status_type_id:"statustype3",status_value_id:"statusvalue3"},{status_type_id:"statustype4",status_value_id:"statusvalue4"},{status_type_id:"statustype5",status_value_id:"statusvalue5"}].any(function(n){var r=t($("#"+n.status_type_id).val()),u=i($("#"+n.status_value_id).val());return r>0&&r<s.length&&u>0}),u;n&&(u=t($("#maximumgradeid").val()),(u<=0||u>=o.length)&&(n=!1));n&&$("#itempricelist tr[data-availableitemprice='true'] input[type='checkbox']").each(function(t,i){if($(i).prop("checked")&&r($("#"+$(i).data("itempriceid")).val())<0)return n=!1,!1});$("#calculatebutton").prop("disabled",!n)}function y(n){var t=$("#itemprice"+n);$("#itemused"+n).prop("checked")?($("#itemnotusedtext"+n).hide(),r(t.val())>0?(t.removeClass("errortextcontrolstyle").prop("disabled",!1),$("#itempriceerrormessage"+n).hide()):(t.removeClass("errortextcontrolstyle").addClass("errortextcontrolstyle").prop("disabled",!1),t.val()===""?$("#itempriceerrormessage"+n).data("text",$("#itempriceerrormessage_empty").val()).show():$("#itempriceerrormessage"+n).data("text",$("#itempriceerrormessage_badformat").val()).show())):($("#itemnotusedtext"+n).show(),t.removeClass("errortextcontrolstyle").val("").prop("disabled",!0),$("#itempriceerrormessage"+n).hide())}function p(){var n,t;localStorage.hasOwnProperty("item_prices")||(localStorage.item_prices=k);localStorage.hasOwnProperty("settings")&&(n=JSON.parse(localStorage.settings),$.each(b,function(t,i){if(n.hasOwnProperty(t)){var r=n[t];switch(i.type){case"plane":i.fire_event?$("#"+t).val(r).change():$("#"+t).val(r);break;case"radio":i.fire_event?$("input[name='"+t+"']").val([r]).change:$("input[name='"+t+"']").val([r])}}}));localStorage.hasOwnProperty("item_prices")&&(t=JSON.parse(localStorage.item_prices),$.each(f,function(n,i){var f,u,e;i!==null&&(f=i.global_item_id,t.hasOwnProperty(f)&&(u=t[f],u==="*"?$("#itemused"+n).prop("checked",!1).change():u.match(/[0-9]+/)!==null?(e=r(u),e>0?($("#itemused"+n).prop("checked",!0).change(),$("#itemprice"+n).val(e.toPriceNumberString()).change()):($("#itemused"+n).prop("checked",!0).change(),$("#itemprice"+n).val("").change())):($("#itemused"+n).prop("checked",!0).change(),$("#itemprice"+n).val("").change())))}))}function v(){var n={},t;$.each(b,function(t,i){switch(i.type){case"plane":n[t]=$("#"+t).val();break;case"radio":n[t]=$("input[name='"+t+"']:checked").val()}});localStorage.settings=JSON.stringify(n);t=f.where(function(n){return n!==null}).toObject(function(n){return n.global_item_id},function(n){var i=n.item_id,t;return $("#itemused"+i).prop("checked")?(t=r($("#itemprice"+i).val()),t>0?t.toString():""):"*"});localStorage.item_prices=JSON.stringify(t)}function ot(t){function k(n){var t={},i;return $.each(n,function(n,i){if(i.status_id>0&&i.status_id<s.length&&i.value>0){var r=i.status_id;t[r]=t.hasOwnProperty(r)?{status_id:i.status_id,value:t[r].value+i.value}:i}}),i=[],$.each(t,function(n,t){i.push(t)}),i}function y(n,t){var r=[],i;return $.each(n,function(n,i){var u=i.status_id,f=s[u];$.each(f.materia_ids,function(n,i){n>0&&n<=t&&r.push(a[i].item_id)})}),i=[],$.each(o,function(n,r){r!==null&&n<=t&&$.each(r.catalyst_ids,function(n,t){var r=l[t].item_id;i.indexOf(r)<0&&i.push(r)})}),i.sort(),r.concat(i)}function d(n,t,i){return y(t,i).all(function(t){return n.hasOwnProperty(t)})}function nt(n){return o.select(function(t){if(t===null)return null;var i=t.catalyst_ids.select(function(t,i){var r=l[t].item_id,u=n.hasOwnProperty(r)?n[r]:-1;return{catalyst_id:t,is_default_catalyst_id:i===0,catalyst_price:u}}).least(function(n){return n.catalyst_price},function(n){return n.catalyst_price>0});return i===undefined?null:i})}function tt(n){var t=[];return $.each(n,function(n,i){var u=w[i.status_id],f,r;u.length>i.value&&(f=u[i.value],r=[],$.each(f,function(n,t){if(t.maximum_grade_id<=e){var i=t.materia_ids;i.length>0&&i.length<=ft&&r.push(i)}}),t.push(r))}),t}function it(n,t){function i(n,t){var i=[];return $.each(n,function(n,r){var u=r.length;u<=t&&i.push(r)}),i}function r(n,t,i){var r=[];return $.each(n,function(n,u){var f=u.length;f<=i&&$.each(t,function(n,t){var e=f+t.length;e<=i&&r.push(u.concat(t))})}),r}function u(n,t,i,r){var u=[];return $.each(n,function(n,f){var e=f.length;e<=r&&$.each(t,function(n,t){var o=e+t.length;o<=r&&$.each(i,function(n,i){var e=o+i.length;e<=r&&u.push(f.concat(t,i))})})}),u}function f(n,t,i,r,u){var f=[];return $.each(n,function(n,e){var o=e.length;o<=u&&$.each(t,function(n,t){var s=o+t.length;s<=u&&$.each(i,function(n,i){var o=s+i.length;o<=u&&$.each(r,function(n,r){var s=o+r.length;s<=u&&f.push(e.concat(t,i,r))})})})}),f}function e(n,t,i,r,u,f){var e=[];return $.each(n,function(n,o){var s=o.length;s<=f&&$.each(t,function(n,t){var h=s+t.length;h<=f&&$.each(i,function(n,i){var s=h+i.length;s<=f&&$.each(r,function(n,r){var h=s+r.length;h<=f&&$.each(u,function(n,u){var s=h+u.length;s<=f&&e.push(o.concat(t,i,r,u))})})})})}),e}switch(n.length){case 1:return i(n[0],t);case 2:return r(n[0],n[1],t);case 3:return u(n[0],n[1],n[2],t);case 4:return f(n[0],n[1],n[2],n[3],t);case 5:return e(n[0],n[1],n[2],n[3],n[4],t);default:return null}}function rt(t,i,r,u,e,h,c){function w(n,t){var i=[];return $.each(t,function(t,r){i.push(n[r])}),i}function b(t,i,r,u,e,h,c){var w={},k;$.each(t,function(n,t){w[t.status_id]=t.value});var v=0,b=[],p=[],y={};return($.each(i,function(t,i){var k=a[i],lt=f[k.item_id],at=lt.name[n],vt=lt.official_site_db_id,ni=s[k.status_id],yt=ni.name[n],it=k.value,d=k.status_id,rt,ot,st,g,ct;y.hasOwnProperty(d)?(rt=y[d],y[d]+=it):(rt=0,y[d]=it);var pt=y[d],ut=w[d],wt=y[d]>w[d],bt=(pt>ut?ut:pt)-(rt>ut?ut:rt),et=o[k.grade_id],ft=u[k.grade_id];if(ft===null)return v=NaN,!1;if(ot=ft.catalyst_id,st=ft.is_default_catalyst_id,$.each(et.catalyst_ids,function(n,t){t<ot&&p.indexOf(t)<0&&p.push(t)}),!r.hasOwnProperty(k.item_id))return v=NaN,!1;if(g=r[k.item_id],g<=0)return v=NaN,!1;var ti=l[ot],kt=f[ti.item_id],dt=kt.name[n],gt=kt.official_site_db_id,nt=ft.catalyst_price,ii=e?et.success_rate_hq:et.success_rate_nq,tt=c+t,ht;if(tt<h)ht=g+nt,b.push({index:tt,is_safety:!0,success_rate:1,materia_name:at,materia_official_site_db_id:vt,materia_price:g,status_name:yt,status_value:it,effective_status_value:bt,is_too_large_value:wt,catalyst_name:dt,catalyst_official_site_db_id:gt,catalyst_price:nt,is_default_catalyst:st,cost:g+nt});else if(tt<5)ct=ii[tt-h],ht=(g+nt)/ct,b.push({index:tt,is_safety:!1,success_rate:ct,materia_name:at,materia_official_site_db_id:vt,materia_price:g,status_name:yt,status_value:it,effective_status_value:bt,is_too_large_value:wt,catalyst_name:dt,catalyst_official_site_db_id:gt,catalyst_price:nt,is_default_catalyst:st,cost:g+nt});else throw new Error("コストの計算中にマテリアのインデックスが5以上であることを検出しました。");v+=ht}),isNaN(v))?null:(p.sort(),k=[],$.each(p,function(t,i){var r=f[l[i].item_id];k.push({item_name:r.name[n],official_site_db_id:r.official_site_db_id})}),{total_cost:Math.round(v),materias:b,not_used_catalysts:k})}var y=NaN,v=null,p;return($.each(t,function(n,t){var f=g[t.length];$.each(f,function(n,f){var s=w(t,f),o=b(i,s,r,u,e,h,c);o===null||(isNaN(y)||o.total_cost<y?(y=o.total_cost,v={},v[s]=o):o.total_cost===y&&(v.hasOwnProperty(s)||(v[s]=o)))})}),v===null)?null:(p=[],$.each(v,function(n,t){p.push(t)}),p)}function ut(t,i,r,u,e,o,h,c){var a=[],l;return $.each(e,function(t,i){a.push({status_name:s[i.status_id].name[n],value_string:"+"+i.value})}),l=[],$.each(y(e,t),function(t,i){l.push({item_name:f[i].name[n],price:h[i]})}),{setting:{maximum_grade_id:t,is_high_quality:i,materia_slot_count:r,used_materia_count:u,desired_status:a,consider_kindan:o,item_prices:l},total_cost:c.total_cost,materias:c.materias,not_used_catalysts:c.not_used_catalysts}}var p=t.is_high_quality,b=t.consider_kindan,e=t.maximum_grade_id,r,u,i,c,h;if(e<=0||e>=o.length||(r=t.materia_slot_count,r<=0||r>5)||(u=t.used_materia_count,u<0||u>=5)||(i=k(t.desired_status),i.length<=0)||(c=(b?5:r)-u,c<1)||(h=t.price_list,!d(h,i,e)))return null;var ft=c+1-i.length,et=nt(h),ot=tt(i),st=it(ot,c),v=rt(st,i,h,et,p,r,u);return v===null||v.length<=0?null:ut(e,p,r,u,i,b,h,v[0])}function st(n){var t=[];return $.each(n.setting.desired_status,function(n,i){t.push(i.status_name+i.value_string)}),t.toString()}function ht(n){var t=5,u="",r,f,i;if($.each(n.materias,function(n,i){i.index<t&&(t=i.index);u+="<tr"+(i.is_safety?"":' class="notsafetymateriastyle"')+"><td>"+(i.index+1)+'<\/td><td><a href="http://jp.finalfantasyxiv.com/lodestone/playguide/db/item/'+i.materia_official_site_db_id+'/" target="_blank">'+i.materia_name+"<\/a><\/td><td>"+i.status_name+"<span"+(i.is_too_large_value?' class="toolargestatusvaluestyle"':"")+">+"+i.effective_status_value+"<\/span><\/td><td"+(i.is_default_catalyst?"":' class="notdefaultcatalyststyle"')+'><a href="http://jp.finalfantasyxiv.com/lodestone/playguide/db/item/'+i.catalyst_official_site_db_id+'/" target="_blank">'+i.catalyst_name+'<\/a><\/td><td class="successratecolumnstyle">'+(i.success_rate*100).toFixed(0)+"%<\/td><\/tr>"}),r="",t>0)for(f=$("#usedslottext").val(),i=0;i<t;++i)r+='<tr class="usedmateriastyle"><td>'+(i+1)+'<\/td><td colspan="4"><span>'+f+"<\/span><\/tr>";return r+u}function ct(n){if(n.not_used_catalysts.length>0){var t="";return $.each(n.not_used_catalysts,function(n,i){t+='<li><a href="http://jp.finalfantasyxiv.com/lodestone/playguide/db/item/'+i.official_site_db_id+'/" target="_blank">'+i.item_name+"<\/a><\/li>"}),t}return""}var f=u.items,o=u.grades,s=u.status,l=u.catalysts,a=u.materias,w=u.materia_counts,g=u.permutation_table,b=u.storage_items,nt=u.gil_names,tt=u.max_status_values,it=u.initial_item_prices,k=u.exsample_item_prices;u=null;$("#statustype1,#statustype2,#statustype3,#statustype4,#statustype5").html(rt());$("#itempricelist tbody").html(ft());$("#maximumgradeid").change(function(){var n=$(this).attr("id");h("statustype1",n);h("statustype2",n);h("statustype3",n);h("statustype4",n);h("statustype5",n);d();c()});$("#statustype1,#statustype2,#statustype3,#statustype4,#statustype5").change(function(){h($(this).attr("id"),"maximumgradeid");d();c()});$("#statusvalue1,#statusvalue2,#statusvalue3,#statusvalue4,#statusvalue5").change(function(){c()});$("#itempricelist input[type='checkbox']").change(function(){var n=$(this).data("itemid");n>0&&(y(n),c())});$("#itempricelist input[type='text']").change(function(){var n=$(this).data("itemid");n>0&&(y(n),c())});$("#itempricelist input[type='text']").keyup(function(){var n=$(this).data("itemid");n>0&&(y(n),c())});$(".errormessageiconstyle").on({mouseenter:function(){var n=$(this).data("text");$(this).append('<div class="errormessagetooltipstyle">'+n+"<\/div>")},mouseleave:function(){$(this).find(".errormessagetooltipstyle").remove()}});$("#itempriceclearbutton").on("click",function(){v();localStorage.item_prices=it;p()});$("#itempriceexsamplebutton").on("click",function(){v();localStorage.item_prices=k;p()});$("#pagelayout").change(function(){v();location.reload()});$("a[href='#mainview']").on("click",function(){e("mainview")});$("a[href='#outlineview']").on("click",function(){e("outlineview")});$("a[href='#generalsettingview']").on("click",function(){e("generalsettingview")});$("#calculatebutton").on("click",function(){v();var r={maximum_grade_id:t($("#maximumgradeid").val()),is_high_quality:$("input[name='quality']:checked").val()==="hq",materia_slot_count:i($("#materiaslotcount").val()),used_materia_count:i($("#usedmateriacount").val()),desired_status:[{status_id:t($("#statustype1").val()),value:i($("#statusvalue1").val())},{status_id:t($("#statustype2").val()),value:i($("#statusvalue2").val())},{status_id:t($("#statustype3").val()),value:i($("#statusvalue3").val())},{status_id:t($("#statustype4").val()),value:i($("#statusvalue4").val())},{status_id:t($("#statustype5").val()),value:i($("#statusvalue5").val())}],consider_kindan:$("input[name='kindanallowed']:checked").val()==="enabled",price_list:et()},n=ot(r);n!==null?($("#resultdesiredstatustable").text(st(n)),$("#resulttotalcostvalue").text(n.total_cost<=0?"":n.total_cost.toPriceNumberString()),$("#resultmateriastable").html(ht(n)),$("#resultwarninglist").html(ct(n)),$("#resultwarninglist").html()!==""?$("#resultwarningview").show():$("#resultwarningview").hide(),e("resultview")):e("errorview")});p();$("#loadingview").hide();$("footer").show();switch(location.hash){case"#generalsettingview":case"#outlineview":e(location.hash.substring(1));break;default:e("mainview")}})});